{{- define "main" -}}

<div class="facility-list-page">
  <!-- Decorative Background Bars -->
  <div class="decorative-bg decorative-bg-left"></div>
  <div class="decorative-bg decorative-bg-right"></div>
  
  <div class="facility-split-layout">
    <!-- Left Side - Image Display -->
    <div class="facility-images-section">
      <div class="image-container top-image">
        <img id="topImage" src="" alt="x96 Image 1" class="facility-display-image">
      </div>
      <div class="image-container bottom-image">
        <img id="bottomImage" src="" alt="x96 Image 2" class="facility-display-image">
      </div>
    </div>

    <!-- Right Side - Content -->
    <div class="facility-content-section">
      <div class="facility-header">
        <h1 class="facility-main-title">{{ .Title }}</h1>
        <p class="facility-subtitle">A list of available x96 projects offered by Professor Zheng</p>
      </div>

      <!-- Projects Section -->
      <div class="facility-section">
        <h2 class="section-title">Projects</h2>
        <div class="facilities-list">
          {{ $firstProject := true }}
          {{ range .Pages.ByDate.Reverse }}
            {{ if eq .Params.subtype "project" }}
              {{ $imageUrlTop := "" }}
              {{ $imageUrlBottom := "" }}
              {{ with .Params.image }}
                {{ $topFilename := .filename_top | default .filename }}
                {{ $bottomFilename := .filename_bottom | default .filename }}
                {{ with $topFilename }}
                  {{ $topResource := resources.Get (printf "media/%s" .) }}
                  {{ if $topResource }}
                    {{ $imageUrlTop = $topResource.RelPermalink }}
                  {{ end }}
                {{ end }}
                {{ with $bottomFilename }}
                  {{ $bottomResource := resources.Get (printf "media/%s" .) }}
                  {{ if $bottomResource }}
                    {{ $imageUrlBottom = $bottomResource.RelPermalink }}
                  {{ end }}
                {{ end }}
              {{ end }}
              
              <a href="{{ .RelPermalink }}" class="facility-card-link">
                <div class="facility-item" 
                     data-image-top="{{ $imageUrlTop }}"
                     data-image-bottom="{{ $imageUrlBottom }}"
                     data-first="{{ $firstProject }}">
                  <div class="facility-item-header">
                    <h3 class="facility-item-title">{{ .Title }}</h3>
                    {{ with .Params.subtext }}
                    <div class="facility-sponsor">
                      <span>{{ . }}</span>
                    </div>
                    {{ end }}
                  </div>
                  <div class="facility-item-description">
                    {{ .Summary | plainify | truncate 200 }}
                  </div>
                  <span class="read-more-link">Read more â†’</span>
                </div>
              </a>
              {{ $firstProject = false }}
            {{ end }}
          {{ end }}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const facilityItems = document.querySelectorAll('.facility-item');
  const topImage = document.getElementById('topImage');
  const bottomImage = document.getElementById('bottomImage');
  
  // Set initial images from the first project
  const firstProject = document.querySelector('.facility-item[data-first="true"]');
  if (firstProject) {
    const topImageUrl = firstProject.getAttribute('data-image-top');
    const bottomImageUrl = firstProject.getAttribute('data-image-bottom');
    if (topImageUrl) {
      topImage.src = topImageUrl;
    }
    if (bottomImageUrl) {
      bottomImage.src = bottomImageUrl;
    }
  }
  
  // Add hover effects
  facilityItems.forEach(item => {
    item.addEventListener('mouseenter', function() {
      const topImageUrl = this.getAttribute('data-image-top');
      const bottomImageUrl = this.getAttribute('data-image-bottom');
      if (topImageUrl) {
        topImage.src = topImageUrl;
      }
      if (bottomImageUrl) {
        bottomImage.src = bottomImageUrl;
      }
    });
  });
});
</script>

<style>
/* Main Container */
.facility-list-page {
  position: relative;
  min-height: 100vh;
  background: #ffffff;
}

/* Decorative Background Bars */
.decorative-bg {
  position: fixed;
  width: 80px;
  top: 0;
  bottom: 0;
  z-index: 0;
  pointer-events: none;
}

.decorative-bg-left {
  left: 0;
  background: linear-gradient(135deg, #1e5f4f 0%, #2d7a66 50%, #3d9980 100%);
  opacity: 0.95;
}

.decorative-bg-right {
  right: 0;
  background: linear-gradient(225deg, #1e5f4f 0%, #2d7a66 50%, #3d9980 100%);
  opacity: 0.95;
}

/* Split Layout */
.facility-split-layout {
  position: relative;
  z-index: 1;
  display: grid;
  grid-template-columns: 45% 55%;
  min-height: 100vh;
  margin-left: 80px;
  margin-right: 80px;
  align-items: start;
}

/* Left Side - Images */
.facility-images-section {
  position: sticky;
  top: 80px;
  height: calc(100vh - 160px);
  max-height: 800px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  background: #ffffff;
  padding: 20px;
}

.image-container {
  flex: 1;
  overflow: hidden;
  position: relative;
}

.facility-display-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: opacity 0.5s ease;
}

/* Right Side - Content */
.facility-content-section {
  background: #ffffff;
  padding: 60px 80px 60px 60px;
  overflow-y: auto;
}

/* Header */
.facility-header {
  margin-bottom: 50px;
}

.facility-main-title {
  font-size: 4rem;
  font-weight: 900;
  color: #1a5f4f;
  margin-bottom: 15px;
  letter-spacing: 2px;
}

.facility-subtitle {
  font-size: 1.3rem;
  color: #666;
  font-weight: 400;
  margin: 0;
}

/* Section */
.facility-section {
  margin-bottom: 60px;
}

.section-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: #1a5f4f;
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 30px;
  margin-left: 0;
  padding-bottom: 15px;
  padding-left: 20px;
  border-bottom: 1px solid #d4c9b8;
  border-left: 6px solid #1a5f4f !important;
  display: block;
}

/* Facilities List */
.facilities-list {
  display: flex;
  flex-direction: column;
  gap: 40px;
}

/* Facility Card Link */
.facility-card-link {
  text-decoration: none;
  color: inherit;
  display: block;
}

/* Facility Item */
.facility-item {
  padding: 30px 0;
  border-bottom: 1px solid #d4c9b8;
  cursor: pointer;
  transition: all 0.3s ease;
}

.facility-card-link:hover .facility-item {
  padding-left: 20px;
  background: rgba(26, 95, 79, 0.03);
}

.facility-card-link:last-child .facility-item {
  border-bottom: none;
}

.facility-item-header {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  margin-bottom: 15px;
}

.facility-item-title {
  font-size: 1.8rem;
  font-weight: 700;
  color: #1a5f4f;
  margin: 0;
  flex: 1;
}

.facility-sponsor {
  font-size: 0.95rem;
  color: #666;
  font-style: italic;
  white-space: nowrap;
  margin-left: 20px;
}

.facility-item-description {
  font-size: 1rem;
  line-height: 1.7;
  color: #555;
  margin-bottom: 15px;
}

.read-more-link {
  display: inline-block;
  color: #1a5f4f;
  text-decoration: none;
  font-weight: 600;
  font-size: 0.95rem;
  transition: all 0.3s ease;
}

.read-more-link:hover {
  color: #2d7a66;
  transform: translateX(5px);
}

/* Dark Mode Support */
html.dark .facility-list-page {
  background: #1a1a1a;
}

html.dark .decorative-bg-left,
html.dark .decorative-bg-right {
  opacity: 0.8;
}

html.dark .facility-images-section {
  background: #1a1a1a;
}

html.dark .facility-content-section {
  background: #1a1a1a;
}

html.dark .facility-main-title {
  color: #4db6ac;
}

html.dark .facility-subtitle {
  color: #b0b0b0;
}

html.dark .section-title {
  color: #4db6ac;
  border-bottom-color: #3a3a3a;
  border-left-color: #4db6ac !important;
}

html.dark .facility-item {
  border-bottom-color: #3a3a3a;
}

html.dark .facility-item:hover {
  background: rgba(77, 182, 172, 0.05);
}

html.dark .facility-item-title {
  color: #4db6ac;
}

html.dark .facility-sponsor {
  color: #888;
}

html.dark .facility-item-description {
  color: #b0b0b0;
}

html.dark .read-more-link {
  color: #4db6ac;
}

html.dark .read-more-link:hover {
  color: #6ec9bf;
}

/* Responsive Design */
@media (max-width: 1200px) {
  .decorative-bg {
    width: 60px;
  }
  
  .facility-split-layout {
    grid-template-columns: 40% 60%;
    margin-left: 60px;
    margin-right: 60px;
  }
  
  .facility-content-section {
    padding: 50px 60px 50px 40px;
  }
  
  .facility-main-title {
    font-size: 3.5rem;
  }
}

@media (max-width: 992px) {
  .decorative-bg {
    width: 40px;
  }
  
  .facility-split-layout {
    grid-template-columns: 1fr;
    margin-left: 40px;
    margin-right: 40px;
  }
  
  .facility-images-section {
    position: relative;
    height: 60vh;
  }
  
  .facility-content-section {
    padding: 40px 30px;
  }
  
  .facility-main-title {
    font-size: 3rem;
  }
}

@media (max-width: 768px) {
  .decorative-bg {
    width: 30px;
  }
  
  .facility-split-layout {
    margin-left: 30px;
    margin-right: 30px;
  }
  
  .facility-images-section {
    height: 50vh;
  }
  
  .facility-content-section {
    padding: 30px 20px;
  }
  
  .facility-main-title {
    font-size: 2.5rem;
  }
  
  .facility-subtitle {
    font-size: 1.2rem;
  }
  
  .facility-item-title {
    font-size: 1.5rem;
  }
  
  .facility-item-header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .facility-sponsor {
    margin-left: 0;
    margin-top: 5px;
  }
}

@media (max-width: 480px) {
  .decorative-bg {
    width: 20px;
  }
  
  .facility-split-layout {
    margin-left: 20px;
    margin-right: 20px;
  }
  
  .facility-main-title {
    font-size: 2rem;
  }
  
  .facility-subtitle {
    font-size: 1rem;
  }
  
  .facility-item-title {
    font-size: 1.3rem;
  }
}
</style>

{{- end -}}
